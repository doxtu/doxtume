(this["webpackJsonpplatychat-react"]=this["webpackJsonpplatychat-react"]||[]).push([[0],{181:function(e,t,a){},182:function(e,t,a){"use strict";a.r(t);var n=a(2),c=a(0),s=a.n(c),r=a(14),o=a.n(r),i=a(5),u=a(33),l=a.n(u),j=a(111),b=a(17),d=a(78);a(143);d.a.initializeApp({apiKey:"AIzaSyCSqIX7JgOxs-W0KSP11rWgg_Smyq3dRr0",authDomain:"platychat.firebaseapp.com",databaseURL:"https://platychat.firebaseio.com",projectId:"platychat",storageBucket:"platychat.appspot.com",messagingSenderId:"540254856882",appId:"1:540254856882:web:5eb0db85a5670ceb77cbab"});var O=d.a.auth(),m=(d.a,a(18)),h=a(221),x=a(31),f=a(28),p=a(211),g=a(62),v=a(225),k=a(213),S=a(209),y=Object(S.a)((function(e){return{root:{padding:"20px"},formElement:{width:"100%"},button:{backgroundColor:e.palette.primary.main,color:"#fff","&:hover":{color:"#000"}}}})),E={xs:12,sm:12,md:6,lg:6,xl:6},C=Object(m.g)((function(e){var t=e.history,a=y(),c=s.a.useState({username:"",password:""}),r=Object(f.a)(c,2),o=r[0],u=r[1],l=function(e){var t=e.target,a=t.value,n=t.name;u(Object(i.a)(Object(i.a)({},o),{},Object(x.a)({},n,a)))};return Object(n.jsx)("form",{className:a.root,onSubmit:function(e){e.preventDefault(),O.signInWithEmailAndPassword(o.username,o.password),t.push("/convos")},children:Object(n.jsxs)(p.a,{container:!0,spacing:2,direction:"column",alignContent:"center",children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},E),{},{children:Object(n.jsxs)(g.a,{variant:"h5",style:{textAlign:"center"},children:["Platychat ",Object(n.jsx)("span",{children:"\ud83e\udd86"})]})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},E),{},{children:Object(n.jsx)(v.a,{name:"username",variant:"outlined",size:"small",placeholder:"email",value:o.username,onChange:l,className:a.formElement})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},E),{},{children:Object(n.jsx)(v.a,{name:"password",type:"password",variant:"outlined",placeholder:"password",size:"small",value:o.password,onChange:l,className:a.formElement})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},E),{},{children:Object(n.jsx)(k.a,{className:"".concat(a.button," ").concat(a.formElement),type:"submit",variant:"contained",children:"Login"})}))]})})})),w=a(218),N=a(212),A=a(214),M=a(215),R=a(216),_=a(217),I=a(116),L=a.n(I),T=Object(b.b)((function(e){return{socket:e.socket.socket,user:e.base.user}}))((function(e){var t=e.user,a=e.socket,c=e.convo,s=e.history;return Object(n.jsxs)(A.a,{button:!0,onClick:function(){a.emit("convo-join-request",t.token,t.uid,c.convoid),s.push("/messages/".concat(c.convoid))},children:[Object(n.jsx)(M.a,{children:Object(n.jsx)(R.a,{badgeContent:c.unreadCount,color:"primary",children:Object(n.jsx)(L.a,{})})}),Object(n.jsx)(_.a,{primary:c.convoname,secondary:c.participants})]})})),U=Object(S.a)({root:{padding:"20px"},convoList:{maxHeight:"240px",overflowY:"auto"},input:{height:38}}),W={xs:12,sm:12,md:12,lg:12,xl:12},q=Object(b.b)((function(e){return{convos:e.messages.convos,user:e.base.user,socket:e.socket.socket}}))(Object(m.g)((function(e){var t=e.history,a=e.convos,c=e.user,r=e.socket,o=U(),u=s.a.useState({convoName:"",messagesFilter:""}),l=Object(f.a)(u,2),j=l[0],b=l[1],d=function(e){var t=e.target,a=t.name,n=t.value;b(Object(i.a)(Object(i.a)({},j),{},Object(x.a)({},a,n)))};return Object(n.jsx)(w.a,{className:o.root,children:Object(n.jsxs)(p.a,{container:!0,spacing:1,children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},W),{},{children:Object(n.jsx)(g.a,{variant:"h6",children:"Messages"})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},W),{},{children:Object(n.jsxs)(p.a,{container:!0,children:[Object(n.jsx)(p.a,{item:!0,xs:10,sm:10,md:10,lg:10,xl:10,children:Object(n.jsx)(v.a,{InputProps:{className:o.input},name:"convoName",fullWidth:!0,variant:"outlined",placeholder:"Convo Name...",onChange:d,value:j.convoName})}),Object(n.jsx)(p.a,{item:!0,xs:2,sm:2,md:2,lg:2,xl:2,children:Object(n.jsx)(k.a,{fullWidth:!0,onClick:function(){r.emit("convo-create-request",c.token,c.uid,j.convoName),b(Object(i.a)(Object(i.a)({},j),{},{convoName:""}))},children:"Add"})})]})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},W),{},{children:Object(n.jsxs)(p.a,{container:!0,children:[Object(n.jsx)(p.a,{item:!0,xs:10,sm:10,md:10,lg:10,xl:10,children:Object(n.jsx)(v.a,{InputProps:{className:o.input},name:"messagesFilter",fullWidth:!0,variant:"outlined",placeholder:"Search...",value:j.messagesFilter,onChange:d})}),Object(n.jsx)(p.a,{item:!0,xs:2,sm:2,md:2,lg:2,xl:2,children:Object(n.jsx)(k.a,{className:o.input,fullWidth:!0,children:"Filter"})})]})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({className:o.convoList,item:!0},W),{},{children:Object(n.jsx)(N.a,{dense:!0,children:Object.keys(a).sort((function(e,t){return a[e].unreadCount>a[t].unreadCount?-1:a[e].unreadCount<a[t].unreadCount?1:0})).map((function(e,c){return Object(n.jsx)(T,{convo:a[e],history:t},c)}))})}))]})})}))),D=Object(S.a)({root:{padding:"20px"},messageResults:{maxHeight:"240px",overflowY:"auto"},input:{height:38}}),F={xs:12,sm:12,md:12,lg:12,xl:12},z=Object(b.b)((function(e){return{socket:e.socket.socket,user:e.base.user,messageSearchResults:e.messages.messageSearchResults}}))((function(e){var t=e.socket,a=e.user,c=e.messageSearchResults,r=D(),o=s.a.useState(""),u=Object(f.a)(o,2),l=u[0],j=u[1];return Object(n.jsx)(w.a,{className:r.root,children:Object(n.jsxs)(p.a,{container:!0,spacing:1,children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},F),{},{children:Object(n.jsx)(v.a,{name:"searchMessages",value:l,onChange:function(e){return j(e.target.value)},fullWidth:!0})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},F),{},{children:Object(n.jsx)(k.a,{fullWidth:!0,variant:"contained",onClick:function(){t&&a&&t.emit("convo-search-request",a.token,a.uid,l),j("")},children:"Search"})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({className:r.messageResults,item:!0},F),{},{children:Object(n.jsx)(N.a,{dense:!0,children:c?c.map((function(e,t){return Object(n.jsx)(A.a,{children:Object(n.jsx)(_.a,{children:"".concat(e.alias," (").concat(e.timestamp,") - ").concat(e.rawtext)})},t)})):null})}))]})})})),G=a(227),P="[BASE] SET_DARK_MODE_ENABLED",J="[BASE] SET_USER",B="lollllllll stay mad idiots, im forcing a rerender using redux, stay mad",K=function(e){return{type:J,payload:e}},Z={darkModeEnabled:!1,user:null},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case B:return e;case P:return Object(i.a)(Object(i.a)({},e),{},{darkModeEnabled:n});case J:return Object(i.a)(Object(i.a)({},e),{},{user:n});default:return e}},H=Object(S.a)({root:{padding:"20px"},input:{height:38}}),V={xs:12,sm:12,md:12,lg:12,xl:12},X=Object(b.b)((function(e){return{darkModeEnabled:e.base.darkModeEnabled,socket:e.socket.socket,user:e.base.user}}),(function(e){return{setDarkModeEnabled:function(t){return e(function(e){return{type:P,payload:e}}(t))}}}))((function(e){var t=e.darkModeEnabled,a=e.setDarkModeEnabled,c=e.socket,r=e.user,o=H(),u=s.a.useState(""),l=Object(f.a)(u,2),j=l[0],b=l[1],d=s.a.useState(""),O=Object(f.a)(d,2),m=O[0],h=O[1];return Object(n.jsx)(w.a,{className:o.root,children:Object(n.jsxs)(p.a,{container:!0,children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(n.jsx)(g.a,{variant:"h6",children:"Settings"})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(n.jsxs)(p.a,{container:!0,alignItems:"center",children:[Object(n.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(n.jsx)(g.a,{children:"Dark Mode"})}),Object(n.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(n.jsx)(G.a,{checked:t,onChange:function(e,t){a(t)}})})]})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(n.jsxs)(p.a,{container:!0,alignItems:"center",children:[Object(n.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:6,children:Object(n.jsx)(g.a,{children:"Alias"})}),Object(n.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(n.jsx)(v.a,{name:"alias",value:j,onChange:function(e){return b(e.target.value)},fullWidth:!0})}),Object(n.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:3,children:Object(n.jsx)(k.a,{onClick:function(){r&&r.token&&c&&c.emit("user-alias-request",r.token,r.uid,j),b("")},fullWidth:!0,children:"Set"})})]})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(n.jsxs)(p.a,{container:!0,alignItems:"center",children:[Object(n.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:6,children:Object(n.jsx)(g.a,{children:"Color"})}),Object(n.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(n.jsx)(v.a,{name:"color",placeholder:"#123abf",value:m,fullWidth:!0,onChange:function(e){return h(e.target.value)}})}),Object(n.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:3,children:Object(n.jsx)(k.a,{onClick:function(){r&&r.token&&c&&c.emit("user-color-request",r.token,r.uid,m),h("")},fullWidth:!0,children:"Set"})})]})}))]})})})),Q=Object(S.a)({root:{padding:"20px",maxHeight:"480px",overflowY:"auto"},img:{width:"100%"}}),$={xs:12,sm:12,md:3,lg:3,xl:3},ee=Object(b.b)((function(e){return{user:e.base.user,socket:e.socket.socket,urls:e.messages.galleryUrls}}))((function(e){var t=e.socket,a=e.user,c=e.urls,r=Q();return s.a.useEffect((function(){t&&a&&t.emit("convo-gallery-request",a.token,a.uid)}),[t,a]),Object(n.jsx)(w.a,{className:r.root,children:Object(n.jsx)(p.a,{container:!0,spacing:1,alignItems:"center",children:c.map((function(e,t){return Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},$),{},{children:Object(n.jsx)("img",{className:r.img,alt:"happy-face",src:"".concat("https://doxtu.me","/platychat/").concat(e.rawtext)})}),t)}))})})})),te=Object(S.a)((function(e){return{root:{padding:"20px"}}})),ae={xs:12,sm:12,md:4,lg:4,xl:4},ne={xs:12,sm:12,md:12,lg:12,xl:12},ce=Object(b.b)((function(e){return{socket:e.socket.socket,user:e.base.user,convos:e.messages.convos}}))(Object(m.g)((function(e){var t=e.history,a=e.socket,c=e.user;s.a.useEffect((function(){a&&c&&a.emit("convo-list-request",c.token,c.uid)}),[a,c]);var r=te();return Object(n.jsxs)(p.a,{className:r.root,container:!0,spacing:1,children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ne),{},{children:Object(n.jsx)(k.a,{fullWidth:!0,onClick:function(){O.signOut(),localStorage.clear(),t.push("/login")},children:"Sign Out"})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ae),{},{children:Object(n.jsx)(q,{})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ae),{},{children:Object(n.jsx)(z,{})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ae),{},{children:Object(n.jsx)(X,{})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ne),{},{children:Object(n.jsx)(ee,{})}))]})}))),se=a(226),re=a(219),oe=a(220),ie=Object(S.a)((function(e){return{root:{padding:"20px",height:"90vh"},messages:{height:"80vh",overflowY:"auto"},inputGroup:{height:"10vh"},input:{height:38},button:{backgroundColor:e.palette.primary.main,color:"#fff"}}})),ue="[MESSAGES] SET_CONVOS",le="[MESSAGES] SET_MESSAGE_SEARCH_RESULTS",je="[MESSAGES] SET_CURRENT_CONVOID",be="[MESSAGES] SET_GALLERY_URLS",de=function(e){return{type:ue,payload:e}},Oe={convos:{},currentConvoid:null,messageSearchResults:[],galleryUrls:[]},me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oe,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case ue:return Object(i.a)(Object(i.a)({},e),{},{convos:n});case je:return Object(i.a)(Object(i.a)({},e),{},{currentConvoid:n});case le:return Object(i.a)(Object(i.a)({},e),{},{messageSearchResults:n});case be:return Object(i.a)(Object(i.a)({},e),{},{galleryUrls:n});default:return e}},he={xs:12,sm:12,md:12,lg:12,xl:12},xe={xs:10,sm:10,md:10,lg:10,xl:10},fe={xs:2,sm:2,md:2,lg:2,xl:2},pe=Object(b.b)((function(e){return{user:e.base.user,socket:e.socket.socket,uploader:e.socket.uploader,convos:e.messages.convos,currentConvoid:e.messages.currentConvoid}}),(function(e){return{setCurrentConvoid:function(t){return e(function(e){return{type:je,payload:e}}(t))}}}))(Object(m.g)((function(e){var t=e.match,a=e.user,c=e.socket,r=e.uploader,o=e.convos,u=e.setCurrentConvoid,l=e.currentConvoid,j=t.url.split("/")[2],b=o[j],d=b?b.messages:[];s.a.useEffect((function(){u(j)}),[l]),s.a.useEffect((function(){c.emit("convo-join-request",a.token,a.uid,l)}),[c,a]);var O=ie(),m=s.a.useState(""),h=Object(f.a)(m,2),x=h[0],g=h[1],S=s.a.useState(null),y=Object(f.a)(S,2),E=y[0],C=y[1];s.a.useEffect((function(){E&&E.scrollTo&&E.scrollTo({top:1e6})}),[E,o]);return Object(n.jsxs)(p.a,{className:O.root,container:!0,children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({className:O.messages,item:!0},he),{},{ref:function(e){return C(e)},children:Object(n.jsx)(N.a,{dense:!0,children:d?d.map((function(e,t){var a=e.rawtext;if(/images\/platychat.+/.test(a)&&(a=Object(n.jsxs)(se.a,{children:[Object(n.jsx)("br",{}),Object(n.jsx)("img",{src:"".concat("https://doxtu.me/platychat","/").concat(a),style:{width:"100%"}})]})),/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(a)){var c=a.match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g);c.forEach((function(e){a=a.replace(e,"~")}));var s=a.split("~");a=Object(n.jsx)("span",{children:s.map((function(e,t){return Object(n.jsxs)("span",{children:[e,c[t]?Object(n.jsx)(re.a,{href:c[t],target:"_blank",children:c[t]}):null," "]},t)}))})}return Object(n.jsxs)(A.a,{children:[Object(n.jsx)(oe.a,{children:Object(n.jsx)("span",{children:"\ud83e\udd97"})}),Object(n.jsx)(_.a,{primary:Object(n.jsxs)(se.a,{children:[Object(n.jsx)("span",{style:{color:e.color},children:e.alias}),Object(n.jsx)("span",{children:" ".concat(e.timestamp," - ")}),Object(n.jsx)("span",{children:a})]})})]},t)})):null})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},he),{},{children:Object(n.jsx)("input",{name:"fileUpload",type:"file",onChange:function(e){for(var t=e.target.files,n=function(){o=t[s];var e=function(){for(var e="",t=0;t<9;t++)e+=Math.round(9*Math.random()).toString();return e}();o.meta=e,(i=new FileReader).onload=function(t){c.emit("convo-message-request",a.token,a.uid,l,"/image "+e),r.submitFiles([o])},i.readAsDataURL(o)},s=0;s<t.length;s++){var o,i;n()}}})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({className:O.inputGroup,item:!0},he),{},{children:Object(n.jsx)("form",{autoComplete:"off",onSubmit:function(e){e.preventDefault(),c&&a&&(c.emit("convo-message-request",a.token,a.uid,j,x),g(""))},children:Object(n.jsxs)(p.a,{container:!0,spacing:1,alignItems:"center",justify:"center",children:[Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},xe),{},{children:Object(n.jsx)(v.a,{InputProps:{className:O.input},name:"message",value:x,variant:"outlined",autoComplete:"off",fullWidth:!0,onChange:function(e){var t=e.target.value;g(t)}})})),Object(n.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},fe),{},{children:Object(n.jsx)(k.a,{className:"".concat(O.input," ").concat(O.button),fullWidth:!0,type:"submit",variant:"outlined",children:"Send"})}))]})})}))]})}))),ge=Object(b.b)((function(e){return{user:e.base.user}}))((function(e){var t=e.user;return Object(n.jsx)(h.a,{className:"App",children:Object(n.jsxs)(m.d,{children:[Object(n.jsx)(m.b,{exact:!0,path:"/",render:function(){return t?Object(n.jsx)(m.a,{to:"/convos"}):Object(n.jsx)(m.a,{to:"/login"})}}),Object(n.jsx)(m.b,{exact:!0,path:"/login",render:function(){return t?Object(n.jsx)(m.a,{to:"/convos"}):Object(n.jsx)(C,{})}}),Object(n.jsx)(m.b,{exact:!0,path:"/convos",render:function(){return t?Object(n.jsx)(ce,{}):Object(n.jsx)(m.a,{to:"/login"})}}),Object(n.jsx)(m.b,{exact:!0,path:"/messages/:convoid",render:function(){return t?Object(n.jsx)(pe,{}):Object(n.jsx)(m.a,{to:"/login"})}})]})})})),ve=a(46),ke=a(120),Se=a(24),ye=a(77),Ee=a(121),Ce=a(61),we=a(76),Ne=Object(we.io)("https://doxtu.me"),Ae=a(178),Me="[SOCKET] SET_SOCKET",Re="[SOCKET] CONVO_LIST_RESPONSE",_e={socket:Ne,uploader:new Ae(Ne)},Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_e,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case Me:return Object(i.a)(Object(i.a)({},e),{},{socket:n,uploader:new Ae(n)});default:return e}},Le=l.a.mark(Ue),Te=l.a.mark(We);function Ue(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ce.d)(Re,l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.payload,e.next=3,Object(Ce.c)(de(a));case 3:case"end":return e.stop()}}),e)})));case 2:case"end":return e.stop()}}),Le)}function We(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ce.a)([Object(Ce.b)(Ue)]);case 2:case"end":return e.stop()}}),Te)}var qe=a(117),De={key:"root",storage:a.n(qe).a,whitelist:["base","messages"]},Fe=Object(Se.c)({base:Y,messages:me,socket:Ie}),ze=Object(ye.a)(De,Fe),Ge=Object(Ee.a)(),Pe=[Ge],Je=Object(Se.e)(ze,Se.a.apply(void 0,Pe));Ge.run(We);var Be=Object(ye.b)(Je);console.warn=function(){};var Ke=Object(b.b)((function(e){return{user:e.base.user,socket:e.socket.socket,convos:e.messages.convos}}),(function(e){return{convoListResponse:function(t){return e(function(e){return{type:Re,payload:e}}(t))},setConvos:function(t){return e(de(t))},setUser:function(t){return e(K(t))},setMessageSearchResults:function(t){return e(function(e){return{type:le,payload:e}}(t))},setSocket:function(t){return e(function(e){return{type:Me,payload:e}}(t))},setGalleryUrls:function(t){return e(function(e){return{type:be,payload:e}}(t))}}}))((function(e){var t=e.user,a=e.socket,n=e.convoListResponse,c=e.setConvos,r=e.setSocket,o=e.setMessageSearchResults,u=e.setGalleryUrls;return s.a.useEffect((function(){a&&(a.on("login-response",(function(e){t&&K(Object(i.a)(Object(i.a)({},t),{},{color:e}))})),a.on("convo-list-response",(function(e){var t=JSON.parse(e).reduce((function(e,t){return e[t.convoid]=t,e}),{});n(t)})),a.on("convo-gallery-response",(function(e){var t=JSON.parse(e);u(t)})),a.on("convo-create-response",(function(e,t){var a=Je.getState().messages.convos;c(Object(i.a)(Object(i.a)({},a),{},Object(x.a)({},e,{convoid:e,convoname:t})))})),a.on("convo-join-response",(function(e,t){c(Object(i.a)(Object(i.a)({},Je.getState().messages.convos),{},Object(x.a)({},e,Object(i.a)(Object(i.a)({},Je.getState().messages.convos[e]),{},{messages:JSON.parse(t)}))))})),a.on("convo-message-response",(function(e){})),a.on("convo-message-incoming",(function(e,t,a,n,s,r){var o=Je.getState().messages.convos;c(Object(i.a)(Object(i.a)({},o),{},Object(x.a)({},e,Object(i.a)(Object(i.a)({},o[e]),{},{messages:[].concat(Object(ke.a)(o[e].messages?o[e].messages:[]),[{convoid:e,todayString:t,alias:a,color:n,timestamp:s,rawtext:r}])}))))})),a.on("convo-search-response",(function(e){o(JSON.parse(e))})))}),[a,K]),s.a.useEffect((function(){window.addEventListener("focus",(function(){Je.getState().socket.socket.off(),r(Object(we.io)("https://doxtu.me"))})),window.addEventListener("paste",(function(e){for(var t,n=Je.getState().messages.currentConvoid,c=e.clipboardData.items,s=0;s<c.length;s++)if("file"===c[s].kind){t=c[s].getAsFile();break}if("undefined"!==typeof t){var r=new FileReader,o=function(){for(var e="",t=0;t<9;t++)e+=Math.round(9*Math.random()).toString();return e}();t.meta=o,r.onload=function(e){a.emit("convo-message-request",Je.getState().base.user.token,Je.getState().base.user.uid,n,"/image "+o),Je.getState().socket.uploader.submitFiles([t])},r.readAsDataURL(t)}}))}),[]),null})),Ze=a(222),Ye=a(119),He=a(223),Ve=a(224),Xe={palette:{primary:{main:"#7703fc"},secondary:{main:"#333"}}};var Qe=Object(b.b)((function(e){return{darkModeEnabled:e.base.darkModeEnabled,user:e.base.user,socket:e.socket.socket,convos:e.messages.convos}}),(function(e){return{setUser:function(t){return e(K(t))},setConvos:function(t){return e(de(t))}}}))((function(e){var t=e.socket,a=e.user,c=e.darkModeEnabled,r=e.setUser,o=(e.setConvos,Object(Ze.a)("(prefers-color-scheme: dark)"));s.a.useEffect((function(){O.onAuthStateChanged(function(){var e=Object(j.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",r(t));case 2:return e.next=4,t.getIdToken(!0);case 4:a=e.sent,t.token=a,r(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),s.a.useEffect((function(){t&&a&&t.emit("login-request",a.token,a.uid)}),[t,a]);var u=s.a.useMemo((function(){return Object(Ye.a)(Object(i.a)(Object(i.a)({},Xe),{},{palette:Object(i.a)(Object(i.a)({},Xe.palette),{},{type:o||c?"dark":"light"})}))}),[o,c]);return Object(n.jsx)(ve.a,{basename:"/platychat",children:Object(n.jsxs)(He.a,{theme:u,children:[Object(n.jsx)(Ve.a,{}),Object(n.jsx)(Ke,{}),Object(n.jsx)(ge,{})]})})})),$e=a(118),et=(a(181),function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,229)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),c(e),s(e),r(e)}))});o.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(b.a,{store:Je,children:Object(n.jsx)($e.a,{persistor:Be,children:Object(n.jsx)(Qe,{})})})}),document.getElementById("root")),et()}},[[182,1,2]]]);
//# sourceMappingURL=main.1271a8c2.chunk.js.map