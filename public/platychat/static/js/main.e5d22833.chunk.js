(this["webpackJsonpplatychat-react"]=this["webpackJsonpplatychat-react"]||[]).push([[0],{181:function(e,t,n){},182:function(e,t,n){"use strict";n.r(t);var c=n(2),a=n(0),s=n.n(a),r=n(14),o=n.n(r),i=n(4),u=n(34),l=n.n(u),j=n(112),d=n(16),b=n(78);n(143);b.a.initializeApp({apiKey:"AIzaSyCSqIX7JgOxs-W0KSP11rWgg_Smyq3dRr0",authDomain:"platychat.firebaseapp.com",databaseURL:"https://platychat.firebaseio.com",projectId:"platychat",storageBucket:"platychat.appspot.com",messagingSenderId:"540254856882",appId:"1:540254856882:web:5eb0db85a5670ceb77cbab"});var O=b.a.auth(),m=(b.a,n(18)),h=n(222),x=n(32),f=n(28),p=n(211),g=n(63),v=n(226),k=n(213),S=n(209),y=Object(S.a)((function(e){return{root:{padding:"20px"},formElement:{width:"100%"},button:{backgroundColor:e.palette.primary.main,color:"#fff","&:hover":{color:"#000"}}}})),C={xs:12,sm:12,md:6,lg:6,xl:6},E=Object(m.g)((function(e){var t=e.history,n=y(),a=s.a.useState({username:"",password:""}),r=Object(f.a)(a,2),o=r[0],u=r[1],l=function(e){var t=e.target,n=t.value,c=t.name;u(Object(i.a)(Object(i.a)({},o),{},Object(x.a)({},c,n)))};return Object(c.jsx)("form",{className:n.root,onSubmit:function(e){e.preventDefault(),O.signInWithEmailAndPassword(o.username,o.password),t.push("/convos")},children:Object(c.jsxs)(p.a,{container:!0,spacing:2,direction:"column",alignContent:"center",children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},C),{},{children:Object(c.jsxs)(g.a,{variant:"h5",style:{textAlign:"center"},children:["Platychat ",Object(c.jsx)("span",{children:"\ud83e\udd86"})]})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},C),{},{children:Object(c.jsx)(v.a,{name:"username",variant:"outlined",size:"small",placeholder:"email",value:o.username,onChange:l,className:n.formElement})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},C),{},{children:Object(c.jsx)(v.a,{name:"password",type:"password",variant:"outlined",placeholder:"password",size:"small",value:o.password,onChange:l,className:n.formElement})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},C),{},{children:Object(c.jsx)(k.a,{className:"".concat(n.button," ").concat(n.formElement),type:"submit",variant:"contained",children:"Login"})}))]})})})),w=n(218),N=n(212),R=n(214),A=n(215),M=n(216),T=n(217),_=n(117),I=n.n(_),U=Object(d.b)((function(e){return{socket:e.socket.socket,user:e.base.user}}))((function(e){var t=e.user,n=e.socket,a=e.convo,s=e.history;return Object(c.jsxs)(R.a,{button:!0,onClick:function(){n.emit("convo-join-request",t.token,t.uid,a.convoid),s.push("/messages/".concat(a.convoid))},children:[Object(c.jsx)(A.a,{children:Object(c.jsx)(M.a,{badgeContent:a.unreadCount,color:"primary",children:Object(c.jsx)(I.a,{})})}),Object(c.jsx)(T.a,{primary:a.convoname,secondary:a.participants})]})})),L=Object(S.a)({root:{padding:"20px"},convoList:{maxHeight:"240px",overflowY:"auto"},input:{height:38}}),q={xs:12,sm:12,md:12,lg:12,xl:12},W=Object(d.b)((function(e){return{convos:e.messages.convos,user:e.base.user,socket:e.socket.socket}}))(Object(m.g)((function(e){var t=e.history,n=e.convos,a=e.user,r=e.socket,o=L(),u=s.a.useState({convoName:"",messagesFilter:""}),l=Object(f.a)(u,2),j=l[0],d=l[1],b=function(e){var t=e.target,n=t.name,c=t.value;d(Object(i.a)(Object(i.a)({},j),{},Object(x.a)({},n,c)))};return Object(c.jsx)(w.a,{className:o.root,children:Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},q),{},{children:Object(c.jsx)(g.a,{variant:"h6",children:"Messages"})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},q),{},{children:Object(c.jsxs)(p.a,{container:!0,children:[Object(c.jsx)(p.a,{item:!0,xs:10,sm:10,md:10,lg:10,xl:10,children:Object(c.jsx)(v.a,{InputProps:{className:o.input},name:"convoName",fullWidth:!0,variant:"outlined",placeholder:"Convo Name...",onChange:b,value:j.convoName})}),Object(c.jsx)(p.a,{item:!0,xs:2,sm:2,md:2,lg:2,xl:2,children:Object(c.jsx)(k.a,{fullWidth:!0,onClick:function(){r.emit("convo-create-request",a.token,a.uid,j.convoName),d(Object(i.a)(Object(i.a)({},j),{},{convoName:""}))},children:"Add"})})]})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},q),{},{children:Object(c.jsxs)(p.a,{container:!0,children:[Object(c.jsx)(p.a,{item:!0,xs:10,sm:10,md:10,lg:10,xl:10,children:Object(c.jsx)(v.a,{InputProps:{className:o.input},name:"messagesFilter",fullWidth:!0,variant:"outlined",placeholder:"Search...",value:j.messagesFilter,onChange:b})}),Object(c.jsx)(p.a,{item:!0,xs:2,sm:2,md:2,lg:2,xl:2,children:Object(c.jsx)(k.a,{className:o.input,fullWidth:!0,children:"Filter"})})]})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({className:o.convoList,item:!0},q),{},{children:Object(c.jsx)(N.a,{dense:!0,children:Object.keys(n).sort((function(e,t){return n[e].unreadCount>n[t].unreadCount?-1:n[e].unreadCount<n[t].unreadCount?1:0})).map((function(e,a){return Object(c.jsx)(U,{convo:n[e],history:t},a)}))})}))]})})}))),D=Object(S.a)({root:{padding:"20px"},messageResults:{maxHeight:"240px",overflowY:"auto"},input:{height:38}}),F={xs:12,sm:12,md:12,lg:12,xl:12},G=Object(d.b)((function(e){return{socket:e.socket.socket,user:e.base.user,messageSearchResults:e.messages.messageSearchResults}}))((function(e){var t=e.socket,n=e.user,a=e.messageSearchResults,r=D(),o=s.a.useState(""),u=Object(f.a)(o,2),l=u[0],j=u[1];return Object(c.jsx)(w.a,{className:r.root,children:Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},F),{},{children:Object(c.jsx)(v.a,{name:"searchMessages",value:l,onChange:function(e){return j(e.target.value)},fullWidth:!0})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},F),{},{children:Object(c.jsx)(k.a,{fullWidth:!0,variant:"contained",onClick:function(){t&&n&&t.emit("convo-search-request",n.token,n.uid,l),j("")},children:"Search"})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({className:r.messageResults,item:!0},F),{},{children:Object(c.jsx)(N.a,{dense:!0,children:a?a.map((function(e,t){return Object(c.jsx)(R.a,{children:Object(c.jsx)(T.a,{children:"".concat(e.alias," (").concat(e.timestamp,") - ").concat(e.rawtext)})},t)})):null})}))]})})})),P=n(228),z="[BASE] SET_DARK_MODE_ENABLED",K="[BASE] SET_USER",H="lollllllll stay mad idiots, im forcing a rerender using redux, stay mad",J=function(e){return{type:K,payload:e}},B={darkModeEnabled:!1,user:null,rerender:0},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case H:return e;case z:return Object(i.a)(Object(i.a)({},e),{},{darkModeEnabled:c});case K:return Object(i.a)(Object(i.a)({},e),{},{user:c});case H:return console.log("so mad"),Object(i.a)(Object(i.a)({},e),{},{rerender:c});default:return e}},Y=Object(S.a)({root:{padding:"20px"},input:{height:38}}),V={xs:12,sm:12,md:12,lg:12,xl:12},X=Object(d.b)((function(e){return{darkModeEnabled:e.base.darkModeEnabled,socket:e.socket.socket,user:e.base.user}}),(function(e){return{setDarkModeEnabled:function(t){return e(function(e){return{type:z,payload:e}}(t))}}}))((function(e){var t=e.darkModeEnabled,n=e.setDarkModeEnabled,a=e.socket,r=e.user,o=Y(),u=s.a.useState(""),l=Object(f.a)(u,2),j=l[0],d=l[1],b=s.a.useState(""),O=Object(f.a)(b,2),m=O[0],h=O[1];return Object(c.jsx)(w.a,{className:o.root,children:Object(c.jsxs)(p.a,{container:!0,children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(c.jsx)(g.a,{variant:"h6",children:"Settings"})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(c.jsxs)(p.a,{container:!0,alignItems:"center",children:[Object(c.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(c.jsx)(g.a,{children:"Dark Mode"})}),Object(c.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(c.jsx)(P.a,{checked:t,onChange:function(e,t){n(t)}})})]})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(c.jsxs)(p.a,{container:!0,alignItems:"center",children:[Object(c.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:6,children:Object(c.jsx)(g.a,{children:"Alias"})}),Object(c.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(c.jsx)(v.a,{name:"alias",value:j,onChange:function(e){return d(e.target.value)},fullWidth:!0})}),Object(c.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:3,children:Object(c.jsx)(k.a,{onClick:function(){r&&r.token&&a&&a.emit("user-alias-request",r.token,r.uid,j),d("")},fullWidth:!0,children:"Set"})})]})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},V),{},{children:Object(c.jsxs)(p.a,{container:!0,alignItems:"center",children:[Object(c.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:6,children:Object(c.jsx)(g.a,{children:"Color"})}),Object(c.jsx)(p.a,{item:!0,xs:6,sm:6,md:6,lg:6,xl:6,children:Object(c.jsx)(v.a,{name:"color",placeholder:"#123abf",value:m,fullWidth:!0,onChange:function(e){return h(e.target.value)}})}),Object(c.jsx)(p.a,{item:!0,xs:3,sm:3,md:3,lg:3,xl:3,children:Object(c.jsx)(k.a,{onClick:function(){r&&r.token&&a&&a.emit("user-color-request",r.token,r.uid,m),h("")},fullWidth:!0,children:"Set"})})]})}))]})})})),Q=Object(S.a)({root:{padding:"20px",maxHeight:"480px",overflowY:"auto"},img:{width:"100%"}}),$={xs:12,sm:12,md:3,lg:3,xl:3},ee=Object(d.b)((function(e){return{user:e.base.user,socket:e.socket.socket,urls:e.messages.galleryUrls}}))((function(e){var t=e.socket,n=e.user,a=e.urls,r=Q();return s.a.useEffect((function(){t&&n&&t.emit("convo-gallery-request",n.token,n.uid)}),[t,n]),Object(c.jsx)(w.a,{className:r.root,children:Object(c.jsx)(p.a,{container:!0,spacing:1,alignItems:"center",children:a?a.map((function(e,t){return Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},$),{},{children:Object(c.jsx)("img",{className:r.img,alt:"happy-face",src:"".concat("https://doxtu.me","/platychat/").concat(e.rawtext)})}),t)})):null})})})),te=n(219),ne=Object(S.a)({root:{padding:"20px"},alignText:{textAlign:"center"}}),ce=Object(d.b)((function(e){return{user:e.base.user,socket:e.socket.socket,suckCount:e.messages.suckCount}}))((function(e){var t=e.user,n=e.socket,a=e.suckCount,s=ne();return Object(c.jsx)(w.a,{className:s.root,children:Object(c.jsxs)(p.a,{container:!0,direction:"column",alignItems:"center",children:[Object(c.jsx)(p.a,{item:!0,children:Object(c.jsx)(g.a,{variant:"h6",children:"SUCK COUNTER"})}),Object(c.jsx)(p.a,{item:!0,children:Object(c.jsxs)(g.a,{children:[Object(c.jsx)("span",{children:"\ud83d\ude1b"}),Object(c.jsx)("span",{children:"\ud83d\ude1b"}),Object(c.jsx)("span",{children:"\ud83d\ude1b"})]})}),Object(c.jsx)(p.a,{item:!0,style:{width:"100%"},children:Object(c.jsxs)(p.a,{container:!0,spacing:1,alignItems:"center",children:[Object(c.jsx)(p.a,{item:!0,xs:2,sm:2,md:2,lg:2,xl:2,children:Object(c.jsx)(te.a,{color:"primary",onClick:function(){n&&t&&n.emit("suck-increment-request",t.token,t.uid,-1)},children:"OPPS"})}),Object(c.jsx)(p.a,{item:!0,xs:8,sm:8,md:8,lg:8,xl:8,children:Object(c.jsx)(g.a,{className:s.alignText,variant:"h1",children:a})}),Object(c.jsx)(p.a,{item:!0,xs:2,sm:2,md:2,lg:2,xl:2,children:Object(c.jsx)(te.a,{color:"primary",onClick:function(){n&&t&&n.emit("suck-increment-request",t.token,t.uid,1)},children:"SUCK"})})]})})]})})})),ae=Object(S.a)((function(e){return{root:{padding:"20px"}}})),se={xs:12,sm:12,md:4,lg:4,xl:4},re={xs:12,sm:12,md:12,lg:12,xl:12},oe=Object(d.b)((function(e){return{socket:e.socket.socket,user:e.base.user,convos:e.messages.convos}}))(Object(m.g)((function(e){var t=e.history,n=e.socket,a=e.user;s.a.useEffect((function(){n&&a&&(n.emit("convo-list-request",a.token,a.uid),n.emit("suck-counter-request",a.token,a.uid))}),[n,a]);var r=ae();return Object(c.jsxs)(p.a,{className:r.root,container:!0,spacing:1,children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},re),{},{children:Object(c.jsx)(k.a,{fullWidth:!0,onClick:function(){O.signOut(),localStorage.clear(),t.push("/login")},children:"Sign Out"})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},se),{},{children:Object(c.jsx)(W,{})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},se),{},{children:Object(c.jsx)(G,{})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},se),{},{children:Object(c.jsx)(X,{})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},re),{},{children:Object(c.jsx)(ee,{})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},se),{},{children:Object(c.jsx)(ce,{})}))]})}))),ie=n(227),ue=n(220),le=n(221),je=Object(S.a)((function(e){return{root:{padding:"20px",height:"90vh"},messages:{height:"80vh",overflowY:"auto"},inputGroup:{height:"10vh"},input:{height:38},button:{backgroundColor:e.palette.primary.main,color:"#fff"}}})),de="[MESSAGES] SET_CONVOS",be="[MESSAGES] SET_MESSAGE_SEARCH_RESULTS",Oe="[MESSAGES] SET_CURRENT_CONVOID",me="[MESSAGES] SET_GALLERY_URLS",he="[MESSAGES] SET_SUCK_COUNTER",xe=function(e){return{type:de,payload:e}},fe={convos:{},currentConvoid:null,messageSearchResults:[],galleryUrls:[],suckCount:0},pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case de:return Object(i.a)(Object(i.a)({},e),{},{convos:c});case Oe:return Object(i.a)(Object(i.a)({},e),{},{currentConvoid:c});case be:return Object(i.a)(Object(i.a)({},e),{},{messageSearchResults:c});case me:return Object(i.a)(Object(i.a)({},e),{},{galleryUrls:c});case he:return Object(i.a)(Object(i.a)({},e),{},{suckCount:c});default:return e}},ge={xs:12,sm:12,md:12,lg:12,xl:12},ve={xs:10,sm:10,md:10,lg:10,xl:10},ke={xs:2,sm:2,md:2,lg:2,xl:2},Se=Object(d.b)((function(e){return{user:e.base.user,socket:e.socket.socket,uploader:e.socket.uploader,convos:e.messages.convos,currentConvoid:e.messages.currentConvoid}}),(function(e){return{setCurrentConvoid:function(t){return e(function(e){return{type:Oe,payload:e}}(t))}}}))(Object(m.g)((function(e){var t=e.match,n=e.user,a=e.socket,r=e.uploader,o=e.convos,u=e.setCurrentConvoid,l=e.currentConvoid,j=t.url.split("/")[2],d=o[j],b=d?d.messages:[];s.a.useEffect((function(){u(j)}),[l]),s.a.useEffect((function(){a.emit("convo-join-request",n.token,n.uid,l)}),[a,n]);var O=je(),m=s.a.useState(""),h=Object(f.a)(m,2),x=h[0],g=h[1],S=s.a.useState(null),y=Object(f.a)(S,2),C=y[0],E=y[1];s.a.useEffect((function(){C&&C.scrollTo&&C.scrollTo({top:1e6})}),[C,o]);return Object(c.jsxs)(p.a,{className:O.root,container:!0,children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({className:O.messages,item:!0},ge),{},{ref:function(e){return E(e)},children:Object(c.jsx)(N.a,{dense:!0,children:b?b.map((function(e,t){var n=e.rawtext;if(/images\/platychat.+/.test(n)&&(n=Object(c.jsxs)(ie.a,{children:[Object(c.jsx)("br",{}),Object(c.jsx)("img",{src:"".concat("https://doxtu.me/platychat","/").concat(n),style:{width:"100%"}})]})),/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(n)){var a=n.match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g);a.forEach((function(e){n=n.replace(e,"~")}));var s=n.split("~");n=Object(c.jsx)("span",{children:s.map((function(e,t){return Object(c.jsxs)("span",{children:[e,a[t]?Object(c.jsx)(ue.a,{href:a[t],target:"_blank",children:a[t]}):null," "]},t)}))})}return Object(c.jsxs)(R.a,{children:[Object(c.jsx)(le.a,{children:Object(c.jsx)("span",{children:"\ud83e\udd97"})}),Object(c.jsx)(T.a,{primary:Object(c.jsxs)(ie.a,{children:[Object(c.jsx)("span",{style:{color:e.color},children:e.alias}),Object(c.jsx)("span",{children:" ".concat(e.timestamp," - ")}),Object(c.jsx)("span",{children:n})]})})]},t)})):null})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ge),{},{children:Object(c.jsx)("input",{name:"fileUpload",type:"file",onChange:function(e){for(var t=e.target.files,c=function(){o=t[s];var e=function(){for(var e="",t=0;t<9;t++)e+=Math.round(9*Math.random()).toString();return e}();o.meta=e,(i=new FileReader).onload=function(t){a.emit("convo-message-request",n.token,n.uid,l,"/image "+e),r.submitFiles([o])},i.readAsDataURL(o)},s=0;s<t.length;s++){var o,i;c()}}})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({className:O.inputGroup,item:!0},ge),{},{children:Object(c.jsx)("form",{autoComplete:"off",onSubmit:function(e){e.preventDefault(),a&&n&&(a.emit("convo-message-request",n.token,n.uid,j,x),g(""))},children:Object(c.jsxs)(p.a,{container:!0,spacing:1,alignItems:"center",justify:"center",children:[Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ve),{},{children:Object(c.jsx)(v.a,{InputProps:{className:O.input},name:"message",value:x,variant:"outlined",autoComplete:"off",fullWidth:!0,onChange:function(e){var t=e.target.value;g(t)}})})),Object(c.jsx)(p.a,Object(i.a)(Object(i.a)({item:!0},ke),{},{children:Object(c.jsx)(k.a,{className:"".concat(O.input," ").concat(O.button),fullWidth:!0,type:"submit",variant:"outlined",children:"Send"})}))]})})}))]})}))),ye=Object(d.b)((function(e){return{user:e.base.user}}))((function(e){var t=e.user;return Object(c.jsx)(h.a,{className:"App",children:Object(c.jsxs)(m.d,{children:[Object(c.jsx)(m.b,{exact:!0,path:"/",render:function(){return t?Object(c.jsx)(m.a,{to:"/convos"}):Object(c.jsx)(m.a,{to:"/login"})}}),Object(c.jsx)(m.b,{exact:!0,path:"/login",render:function(){return t?Object(c.jsx)(m.a,{to:"/convos"}):Object(c.jsx)(E,{})}}),Object(c.jsx)(m.b,{exact:!0,path:"/convos",render:function(){return t?Object(c.jsx)(oe,{}):Object(c.jsx)(m.a,{to:"/login"})}}),Object(c.jsx)(m.b,{exact:!0,path:"/messages/:convoid",render:function(){return t?Object(c.jsx)(Se,{}):Object(c.jsx)(m.a,{to:"/login"})}})]})})})),Ce=n(47),Ee=n(121),we=n(24),Ne=n(77),Re=n(122),Ae=n(62),Me=n(61),Te=Object(Me.io)("https://doxtu.me"),_e=n(178),Ie="[SOCKET] SET_SOCKET",Ue="[SOCKET] CONVO_LIST_RESPONSE",Le={socket:Te,uploader:new _e(Te)},qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Le,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload;switch(n){case Ie:return console.log("RECONNECTING",c),Object(i.a)(Object(i.a)({},e),{},{socket:c,uploader:new _e(c)});default:return e}},We=l.a.mark(Fe),De=l.a.mark(Ge);function Fe(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ae.d)(Ue,l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,e.next=3,Object(Ae.c)(xe(n));case 3:case"end":return e.stop()}}),e)})));case 2:case"end":return e.stop()}}),We)}function Ge(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ae.a)([Object(Ae.b)(Fe)]);case 2:case"end":return e.stop()}}),De)}var Pe=n(118),ze={key:"root",storage:n.n(Pe).a,whitelist:["base","messages"]},Ke=Object(we.c)({base:Z,messages:pe,socket:qe}),He=Object(Ne.a)(ze,Ke),Je=Object(Re.a)(),Be=[Je],Ze=Object(we.e)(He,we.a.apply(void 0,Be));Je.run(Ge);var Ye,Ve=Object(Ne.b)(Ze);console.warn=function(){},void 0!==typeof document.hidden?("hidden",Ye="visibilitychange"):"undefined"!==typeof document.msHidden?("msHidden",Ye="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&("webkitHidden",Ye="webkitvisibilitychange");var Xe=Object(d.b)((function(e){return{user:e.base.user,socket:e.socket.socket,convos:e.messages.convos}}),(function(e){return{convoListResponse:function(t){return e(function(e){return{type:Ue,payload:e}}(t))},setConvos:function(t){return e(xe(t))},setUser:function(t){return e(J(t))},setMessageSearchResults:function(t){return e(function(e){return{type:be,payload:e}}(t))},setSocket:function(t){return e(function(e){return{type:Ie,payload:e}}(t))},setGalleryUrls:function(t){return e(function(e){return{type:me,payload:e}}(t))},setSuckCounter:function(t){return e(function(e){return{type:he,payload:e}}(t))},forceRerender:function(t){return e(function(e){return{type:H,payload:e}}(t))}}}))((function(e){var t=e.user,n=e.socket,c=e.convoListResponse,a=e.setConvos,r=e.setSocket,o=e.setMessageSearchResults,u=e.setGalleryUrls,l=e.setSuckCounter;e.forceRerender;return s.a.useEffect((function(){n&&(n.on("login-response",(function(e){t&&J(Object(i.a)(Object(i.a)({},t),{},{color:e}))})),n.on("convo-list-response",(function(e){var t=JSON.parse(e).reduce((function(e,t){return e[t.convoid]=t,e}),{});c(t)})),n.on("convo-gallery-response",(function(e){var t=JSON.parse(e);u(t)})),n.on("convo-create-response",(function(e,t){var n=Ze.getState().messages.convos;a(Object(i.a)(Object(i.a)({},n),{},Object(x.a)({},e,{convoid:e,convoname:t})))})),n.on("convo-join-response",(function(e,t){a(Object(i.a)(Object(i.a)({},Ze.getState().messages.convos),{},Object(x.a)({},e,Object(i.a)(Object(i.a)({},Ze.getState().messages.convos[e]),{},{messages:JSON.parse(t)}))))})),n.on("convo-message-response",(function(){})),n.on("convo-message-incoming",(function(e,t,n,c,s,r){console.log("message arrived");var o=Ze.getState().messages.convos;a(Object(i.a)(Object(i.a)({},o),{},Object(x.a)({},e,Object(i.a)(Object(i.a)({},o[e]),{},{messages:[].concat(Object(Ee.a)(o[e].messages?o[e].messages:[]),[{convoid:e,todayString:t,alias:n,color:c,timestamp:s,rawtext:r}])}))))})),n.on("convo-search-response",(function(e){o(JSON.parse(e))})),n.on("convo-image-response",(function(){var e=Ze.getState().messages.currentConvoid,t=Ze.getState().base.user,n=Ze.getState().socket.socket;n&&t&&n.emit("convo-join-request",t.token,t.uid,e)})),n.on("suck-counter-response",l))}),[n,J]),s.a.useEffect((function(){window.addEventListener("focus",(function(){Ze.getState().socket.socket.off(),r(Object(Me.io)("https://doxtu.me"))})),document.addEventListener(Ye,(function(){Ze.getState().socket.socket.off(),r(Object(Me.io)("https://doxtu.me"))})),window.addEventListener("paste",(function(e){for(var t,c=Ze.getState().messages.currentConvoid,a=e.clipboardData.items,s=0;s<a.length;s++)if("file"===a[s].kind){t=a[s].getAsFile();break}if("undefined"!==typeof t){var r=new FileReader,o=function(){for(var e="",t=0;t<9;t++)e+=Math.round(9*Math.random()).toString();return e}();t.meta=o,r.onload=function(e){n.emit("convo-message-request",Ze.getState().base.user.token,Ze.getState().base.user.uid,c,"/image "+o),Ze.getState().socket.uploader.submitFiles([t])},r.readAsDataURL(t)}}))}),[]),null})),Qe=n(223),$e=n(120),et=n(224),tt=n(225),nt={palette:{primary:{main:"#7703fc"},secondary:{main:"#333"}}};var ct=Object(d.b)((function(e){return{darkModeEnabled:e.base.darkModeEnabled,user:e.base.user,socket:e.socket.socket,convos:e.messages.convos}}),(function(e){return{setUser:function(t){return e(J(t))},setConvos:function(t){return e(xe(t))}}}))((function(e){var t=e.socket,n=e.user,a=e.darkModeEnabled,r=e.setUser,o=(e.setConvos,Object(Qe.a)("(prefers-color-scheme: dark)"));s.a.useEffect((function(){O.onAuthStateChanged(function(){var e=Object(j.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",r(t));case 2:return e.next=4,t.getIdToken(!0);case 4:n=e.sent,t.token=n,r(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),s.a.useEffect((function(){t&&n&&t.emit("login-request",n.token,n.uid)}),[t,n]);var u=s.a.useMemo((function(){return Object($e.a)(Object(i.a)(Object(i.a)({},nt),{},{palette:Object(i.a)(Object(i.a)({},nt.palette),{},{type:o||a?"dark":"light"})}))}),[o,a]);return Object(c.jsx)(Ce.a,{basename:"/platychat",children:Object(c.jsxs)(et.a,{theme:u,children:[Object(c.jsx)(tt.a,{}),Object(c.jsx)(Xe,{}),Object(c.jsx)(ye,{})]})})})),at=n(119),st=(n(181),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,230)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),s(e),r(e)}))});o.a.render(Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)(d.a,{store:Ze,children:Object(c.jsx)(at.a,{persistor:Ve,children:Object(c.jsx)(ct,{})})})}),document.getElementById("root")),st()}},[[182,1,2]]]);
//# sourceMappingURL=main.e5d22833.chunk.js.map